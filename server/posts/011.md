Der Weg war schwer, doch jetzt ist es geschafft.

Nachdem ich es gestsern geschafft habe eine neue Version zu deployen, nicht aber in git einzuchecken, war die nÃ¤chste Aufgabe klar: Das git push und das Deployment wieder miteinander zu kombinieren, dennoch beim Deploy per SSH bleiben. Die LÃ¶sung ist CI (Continuous Integration). DafÃ¼r gibt es verschiedene Anbieter. Am einfachsten und dann auch noch kostenlos erschien mir travis-ci.

## Travis CI

[https://travis-ci.org](https://travis-ci.org/) arbeitet wunderbar mit github zusammen. Also schnell mit meinem Repository nach github umgezogen und schwuppdiwupp hat travis mein Repository auch schon automatisch gefunden. Das Grundsetup fÃ¼r node-Projekte ist auch schnell eingerichtet

[https://docs.travis-ci.com/user/languages/javascript-with-nodejs/](https://docs.travis-ci.com/user/languages/javascript-with-nodejs/)

Die nÃ¤chsten Schritte waren recht einfach, da ich eine gute [Anleitung](https://oncletom.io/2016/travis-ssh-deploy/) gefunden habe.

Die Schritte im Kurzen:

1.  SSH-Key fÃ¼r Deployment anlegen
2.  public key bei uberspace (Hoster) hinterlegen
3.  private key mit travis cli verschlÃ¼sseln
4.  uberspace in travis-config zu den known hosts hinzufÃ¼gen
5.  Im Build den private key wieder entschlÃ¼sseln
6.  Deploy-Script ausfÃ¼hren

```yaml
language: node_js
node_js:
  - node
addons:
  ssh_known_hosts: schedar.uberspace.de
before_deploy:
  - >-
    openssl aes-256-cbc -K $encrypted_9bf0a667aeff_key -iv
    $encrypted_9bf0a667aeff_iv -in deploy_rsa.enc -out /tmp/deploy_rsa -d
  - eval "$(ssh-agent -s)"
  - chmod 600 /tmp/deploy_rsa
  - ssh-add /tmp/deploy_rsa
deploy:
  provider: script
  skip_cleanup: true
  script: bash scripts/deploy.sh
  on:
    branch: master
```

## Schwierigkeiten

Die travis CLI scheint unter Windows nicht korrekt zu funktionieren. Das EntschlÃ¼sseln der unter Windows verschlÃ¼sselten Keys schlug im Build fehl. Also schnell den Rechner unter Ubuntu neu starten und... Travis CLI installieren:

```bash
# install ruby
sudo apt install ruby
# install gems manager (maybe not needed, but hwo knows)
sudo apt-get install rubygems
# needed headers
sudo apt-get install ruby-all-dev
# travis
sudo gem install travis
travis login
```

Als das dann geschafft war, lief dann auch endlich der Build durch und Travis liefert nach jedem Push des Master-Branches meinen Blog neu aus ğŸ’ª
